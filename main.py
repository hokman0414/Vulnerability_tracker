import requests
import json
from urlextract import URLExtract
import csv
LINK = "https://cvetrends.com/api/cves/24hrs"
NVD = "https://nvd.nist.gov/vuln/detail/"
#library for URL extraction
extractor = URLExtract
#extract response from link
html = requests.get(LINK).text
#make it into python dictionary format
data = json.loads(html)

#create CSV file w all access to read and write
file = open("CVEVulnTracker.csv","a", newline="")
writer = csv.writer(file)
#state titles one first row
title = ["CVE","Date Published","Last Modified","NVD link", "Does It Work?"]
writer.writerow(title)

#for loops for each data in columns CVEs + the date it was created
#[(cve['cve'],cve["publishedDate"],cve["lastModifiedDate"]) for cve in data['data']]
#when comma seperate list, it will seperate cells
for cve in data['data']:
    link_data = []
    #append the NVD link too in addition to cve data from json
    #if verified that the NVD links does not work using bs4, add No
    # link_data.append((cve['cve'],cve["publishedDate"],cve["lastModifiedDate"],NVD+cve['cve']),"No")

    #else:(run the append as is
    link_data.append((cve['cve'],cve["publishedDate"],cve["lastModifiedDate"],NVD+cve['cve']),"Yes")
    # data all appended double check
    print(link_data)
    # write the data to the tables:
    writer.writerows(link_data)
#close the created file
file.close()

#plan to verify if the NVD link works or not




